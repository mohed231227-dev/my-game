<!DOCTYPE html>
<html lang="ar">
<head>
  <meta http-equiv="Content-Security-Policy" content="default-src * 'unsafe-inline' 'unsafe-eval'; style-src * 'unsafe-inline'; script-src * 'unsafe-inline' 'unsafe-eval' *;">
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>لعبة الكرة — سحابي + متجر</title>
<style>
:root{--bg:#0f1112;--panel:#17191a;--muted:#bfbfbf;--accent:#ffd166}
*{box-sizing:border-box}
body{margin:0;font-family:Tahoma, Arial, sans-serif;background:var(--bg);color:#fff;direction:rtl}
header{display:flex;justify-content:space-between;align-items:center;padding:12px 18px;background:linear-gradient(90deg,#0b0b0b,#141414);border-bottom:1px solid #242424}
header h1{margin:0;font-size:18px}
.balance{font-size:14px;color:var(--muted)}
main{padding:16px}
.screen{display:none}
.active{display:block}
.panel{background:var(--panel);padding:12px;border-radius:8px;border:1px solid #232425;max-width:1024px;margin:0 auto}
.menu{display:flex;gap:12px;flex-direction:column;align-items:center}
button{background:#252627;color:#fff;padding:10px 14px;border-radius:8px;border:1px solid #2f3031;cursor:pointer}
button.secondary{background:transparent;border:1px solid #2f3031;color:var(--muted)}
.small{padding:6px 10px;font-size:13px}
canvas{display:block;margin:12px auto;border-radius:6px;border:3px solid #222;background:linear-gradient(#2b2b2b,#212121)}
.row{display:flex;gap:12px;flex-wrap:wrap}
.muted{color:var(--muted)}
.tabs{display:flex;gap:8px;margin-bottom:12px}
.tab{padding:8px 12px;border-radius:8px;background:#222;border:1px solid #2a2a2a;cursor:pointer}
.tab.active{background:linear-gradient(#2f2f2f,#272727)}
.grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:12px}
.card{background:#1e1f20;padding:10px;border-radius:8px;border:1px solid #2a2a2a}
.charPreview{width:84px;height:84px;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:bold;color:#111}
.stat{font-size:13px;color:var(--muted);margin-top:6px}
.overlay{position:fixed;inset:0;background:rgba(0,0,0,0.6);display:flex;align-items:center;justify-content:center;z-index:40}
.modal{background:#111;padding:18px;border-radius:10px;border:1px solid #2a2a2a;min-width:320px;text-align:center}
input[type="text"],input[type="email"],input[type="password"]{padding:8px 10px;border-radius:6px;border:1px solid #333;background:#121212;color:#fff;margin-left:8px}
footer{padding:12px;text-align:center;color:var(--muted);font-size:13px;margin-top:12px}
.buyBtn{background:#2e7d32}
.disabled{opacity:0.5;pointer-events:none}
.detailImg{width:180px;height:120px;object-fit:cover;border-radius:8px;background:#222}
</style>
</head>
<body>

<header>
  <h1>لعبتي — الكرة القافزة</h1>
  <div>
    <span id="headerUser" class="muted">لا يوجد حساب</span>
    &nbsp;&nbsp;
    <span id="headerBalance" class="balance">الكوينز: 0</span>
  </div>
</header>

<main>
  <section id="mainMenu" class="screen active">
    <div class="panel menu">
      <h2>القائمة الرئيسية</h2>
      <div class="row" style="justify-content:center;width:100%">
        <button id="btnStart">ابدأ اللعبة</button>
        <button onclick="showScreen('shop')" class="secondary">المتجر</button>
        <button onclick="showScreen('settings')" class="secondary">الإعدادات</button>
      </div>
      <p class="muted">يجب تسجيل الدخول للعب أو استخدام النسخة المحلية.</p>
    </div>
  </section>

  <section id="shop" class="screen">
    <div class="panel">
      <h2>🛒 المتجر</h2>
      <div class="tabs" role="tablist">
        <div id="tabChars" class="tab active" onclick="activateShopTab('chars')">أ — شخصيات</div>
        <div id="tabAbilities" class="tab" onclick="activateShopTab('abilities')">ب — قدرات</div>
      </div>

      <div id="shopChars" class="shopSection">
        <div class="grid" id="charsGrid"></div>
      </div>

      <div id="shopAbilities" class="shopSection" style="display:none">
        <div class="grid" id="abilitiesGrid"></div>
      </div>

      <div style="margin-top:12px;text-align:center">
        <button onclick="showScreen('mainMenu')" class="secondary">رجوع</button>
      </div>
    </div>
  </section>

  <section id="settings" class="screen">
    <div class="panel">
      <h2>⚙️ الإعدادات</h2>

      <div style="margin-bottom:12px">
        <h3>تسجيل / تسجيل دخول</h3>
        <div style="display:flex;gap:8px;align-items:center">
          <input id="email" type="email" placeholder="الإيميل">
          <input id="password" type="password" placeholder="كلمة المرور">
          <button onclick="signup()" class="small">تسجيل</button>
          <button onclick="signin()" class="small">تسجيل دخول</button>
          <button onclick="googleSignIn()" class="small">تسجيل بجوجل</button>
          <button onclick="signout()" class="small secondary">تسجيل خروج</button>
        </div>
        <div id="accountInfo" class="muted" style="margin-top:8px">لا يوجد حساب متصل</div>
      </div>

      <div style="margin-top:8px">
        <h3>الصوت</h3>
        <button onclick="toggleSound()" class="small">تشغيل/إيقاف الصوت</button>
        <div id="soundInfo" class="muted" style="margin-top:6px">الصوت: مفعل</div>
      </div>

      <div style="margin-top:12px" class="center">
        <button onclick="showScreen('mainMenu')" class="secondary">رجوع</button>
      </div>
    </div>
  </section>

  <section id="game" class="screen">
    <div class="panel">
      <div class="row" style="justify-content:space-between;align-items:center;margin-bottom:6px">
        <div>المسافة: <span id="distanceDisplay">0</span></div>
        <div>الكوينز: <span id="coinsDisplay">0</span></div>
        <div>الشخصية: <span id="activeCharName">افتراضي</span></div>
      </div>
      <canvas id="gameCanvas" width="900" height="380"></canvas>

      <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
        <button id="btnEnd" class="secondary">القائمة</button>
        <button id="btnPause" class="secondary">إيقاف</button>
        <div class="muted">ملاحظة: اضغط Space للقفز</div>
      </div>
    </div>
  </section>
</main>

<div id="detailModal" class="overlay" style="display:none">
  <div class="modal" id="detailContent">
    <h3 id="detailTitle">تفاصيل</h3>
    <img id="detailImg" class="detailImg" src="" alt="image">
    <p id="detailDesc" class="muted"></p>
    <div style="margin-top:8px">
      <button id="detailBuyBtn" class="buyBtn">اشتري</button>
      <button onclick="closeDetail()" class="secondary">إغلاق</button>
    </div>
  </div>
</div>

<div id="gameOver" class="overlay" style="display:none">
  <div class="modal">
    <h3>انتهت اللعبة</h3>
    <p id="goStats" class="muted">المسافة: 0 — الكوينز المكتسبة: 0</p>
    <div style="margin-top:10px;display:flex;gap:8px;justify-content:center">
      <button id="retryBtn">إعادة المحاولة</button>
      <button onclick="closeGameOver()" class="secondary">القائمة الرئيسية</button>
    </div>
  </div>
</div>

<footer>مشروع جاهز للتشغيل محليًا أو رفعه على Netlify/GitHub Pages</footer>

<!-- Firebase SDKs -->



<script>
// Global function used by inline onclick attributes to switch screens
function showScreen(id){
  // remove 'active' from all screens
  document.querySelectorAll('.screen').forEach(s=>s.classList.remove('active'));
  // add active to target if exists
  var el = document.getElementById(id);
  if(el){ el.classList.add('active'); }
  // pause game if leaving game screen
  if(typeof game !== 'undefined' && id !== 'game'){
    try{ cancelAnimationFrame(game.animationId); }catch(e){}
    game.running = false;
  }
  // update header UI (in case)
  try{ if(typeof updateHeaderUI === 'function') updateHeaderUI(); }catch(e){}
}
</script>


<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
  import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-analytics.js";
  import { 
    getAuth, 
    createUserWithEmailAndPassword, 
    signInWithEmailAndPassword, 
    GoogleAuthProvider, 
    signInWithPopup, 
    signOut, 
    onAuthStateChanged 
  } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

  const firebaseConfig = {
    apiKey: "AIzaSyBe2_Jgp_uUERMkNCbuSkAtJ2bGe0XEZiY",
    authDomain: "my-game-cd178.firebaseapp.com",
    projectId: "my-game-cd178",
    storageBucket: "my-game-cd178.appspot.com",
    messagingSenderId: "582046400327",
    appId: "1:582046400327:web:fe84c9da54118dc5fe5662",
    measurementId: "G-WN5SD1W8ML"
  };

  const app = initializeApp(firebaseConfig);
  const analytics = getAnalytics(app);
  const auth = getAuth(app);
  const provider = new GoogleAuthProvider();

  window.signup = function() {
    const email = document.getElementById('signupEmail').value;
    const password = document.getElementById('signupPassword').value;
    createUserWithEmailAndPassword(auth, email, password)
      .then(userCredential => {
        alert("تم إنشاء الحساب بنجاح ✅");
      })
      .catch(error => {
        alert("خطأ في إنشاء الحساب: " + error.message);
      });
  };

  window.signin = function() {
    const email = document.getElementById('signinEmail').value;
    const password = document.getElementById('signinPassword').value;
    signInWithEmailAndPassword(auth, email, password)
      .then(userCredential => {
        alert("تم تسجيل الدخول بنجاح ✅");
      })
      .catch(error => {
        alert("خطأ في تسجيل الدخول: " + error.message);
      });
  };

  window.googleSignIn = function() {
    signInWithPopup(auth, provider)
      .then(result => {
        alert("تم تسجيل الدخول بحساب Google ✅");
      })
      .catch(error => {
        alert("خطأ في تسجيل دخول Google: " + error.message);
      });
  };

  window.signout = function() {
    signOut(auth).then(() => {
      alert("تم تسجيل الخروج ✅");
    }).catch(error => {
      alert("خطأ في تسجيل الخروج: " + error.message);
    });
  };

  onAuthStateChanged(auth, (user) => {
    const headerUser = document.getElementById('headerUser');
    if (user) {
      headerUser.textContent = user.email;
    } else {
      headerUser.textContent = "غير مسجل";
    }
  });
</script>

</body>
</html>